<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>资产管理中心 - H-System EDR平台</title>
    <style>
        /* 基础样式 */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Microsoft YaHei", sans-serif; }
        body { display: flex; height: 100vh; overflow: hidden; background-color: #f5f7fa; }

        /* 左侧菜单栏 */
        .sidebar { width: 220px; background-color: #2c3e50; color: white; height: 100%; transition: all 0.3s; overflow-y: auto; }
        .sidebar-header { padding: 20px; text-align: center; border-bottom: 1px solid #34495e; }
        .sidebar-header h1 { font-size: 18px; font-weight: 600; }
        .menu-list { list-style: none; }
        .menu-item { padding: 15px 20px; cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; border-left: 3px solid transparent; text-decoration: none; color: white; position: relative; }
        .menu-item:hover { background-color: #34495e; }
        .menu-item.active { background-color: #34495e; border-left-color: #3498db; }
        .menu-item i { margin-right: 10px; width: 20px; text-align: center; }

        /* 右侧主内容区 */
        .main-container { flex: 1; min-width: 0; display: flex; flex-direction: column; height: 100%; }
        .top-bar { height: 60px; background-color: white; border-bottom: 1px solid #ecf0f1; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .user-info { display: flex; align-items: center; }
        .user-info img { width: 36px; height: 36px; border-radius: 50%; margin-right: 10px; }
        .content-area { flex: 1; padding: 20px; overflow-y: auto; background-color: #f5f7fa; }
        .page-title { font-size: 22px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }
        .card { background-color: white; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); padding: 20px; margin-bottom: 20px; }
        .stat-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .stat-card { padding: 15px; border-radius: 6px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #e9ecef; }
        .stat-card-value { font-size: 28px; font-weight: bold; margin-bottom: 5px; }
        .stat-card-label { font-size: 14px; color: #6c757d; }
        .stat-card-value.critical { color: #c0392b; }
        .stat-card-value.high { color: #e74c3c; }
        .stat-card-value.medium { color: #f39c12; }
        .stat-card-value.success { color: #27ae60; }
        .filter-bar { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 15px; align-items: center; background: #f8f9fa; padding: 15px; border-radius: 6px; }
        .filter-group { display: flex; align-items: center; }
        .filter-group label { margin-right: 8px; color: #666; font-size: 14px; }
        .filter-bar select, .filter-bar input { padding: 6px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .btn { padding: 6px 12px; border-radius: 4px; border: none; cursor: pointer; font-size: 14px; transition: all 0.2s; display: inline-flex; align-items: center; gap: 5px; }
        .btn-primary { background-color: #3498db; color: white; }
        .btn-primary:hover { background-color: #2980b9; }
        .btn-outline { background-color: transparent; border: 1px solid #3498db; color: #3498db; }
        .btn-outline:hover { background-color: #3498db; color: white; }
        .data-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 14px; }
        .data-table th, .data-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ecf0f1; }
        .data-table th { background-color: #f8f9fa; font-weight: 600; color: #495057; }
        .data-table tr:hover { background-color: #f8f9fa; }
        .table-actions { display: flex; gap: 8px; }
        .tag { display: inline-block; padding: 3px 10px; border-radius: 15px; font-size: 12px; font-weight: 500; white-space: nowrap; }
        .tag-server { background-color: #dbeafe; color: #1e40af; }
        .tag-workstation { background-color: #e0e7ff; color: #4338ca; }
        .tag-danger { background-color: #fee2e2; color: #dc2626; }
        .tag-warning { background-color: #fef3c7; color: #d97706; }
        .tag-normal { background-color: #dcfce7; color: #166534; }
        .tag-offline { background-color: #e5e7eb; color: #4b5563; }
        .pagination { display: flex; justify-content: center; gap: 5px; margin-top: 20px; }
        .pagination button { padding: 5px 12px; border: 1px solid #ddd; background-color: white; cursor: pointer; border-radius: 4px; }
        .pagination button.active { background-color: #3498db; color: white; border-color: #3498db; }
        .chart-container { height: 300px; position: relative; }
        .charts-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .toast { position: fixed; bottom: 20px; right: 20px; background-color: rgba(44,62,80,0.9); color: white; padding: 12px 20px; border-radius: 6px; z-index: 9999; animation: fadeIn 0.3s, fadeOut 0.3s 2.7s forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(20px); } }
        
        /* Tab Navigation */
        .tab-nav { display: flex; border-bottom: 2px solid #dee2e6; margin-bottom: 20px; }
        .tab-item { padding: 10px 20px; cursor: pointer; font-size: 16px; color: #6c757d; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: color 0.2s, border-color 0.2s; }
        .tab-item:hover { color: #34495e; }
        .tab-item.active { color: #3498db; border-bottom-color: #3498db; font-weight: 600; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeInContent 0.5s; }
        @keyframes fadeInContent { from { opacity: 0; } to { opacity: 1; } }

        /* Severity & Compliance Tags */
        .severity-critical { background-color: #c0392b; color: white; }
        .severity-high { background-color: #e74c3c; color: white; }
        .severity-medium { background-color: #f39c12; color: white; }
        .severity-low { background-color: #3498db; color: white; }
        .compliance-passed { background-color: #27ae60; color: white; }
        .cvss-score { font-weight: bold; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- 左侧菜单栏 (已恢复为标准样式) -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h1>H-System EDR平台</h1>
        </div>
        <div class="menu-list">
            <a href="index.html" class="menu-item">
                <i class="fas fa-tachometer-alt"></i>
                <span>安全态势</span>
            </a>
            <a href="alert-center.html" class="menu-item">
                <i class="fas fa-exclamation-triangle"></i>
                <span>告警中心</span>
            </a>
            <a href="investigation.html" class="menu-item">
                <i class="fas fa-search"></i>
                <span>调查与响应</span>
            </a>
            <a href="asset-management.html" class="menu-item active">
                <i class="fas fa-desktop"></i>
                <span>资产管理</span>
            </a>
            <a href="threat-hunting.html" class="menu-item">
                <i class="fas fa-crosshairs"></i>
                <span>威胁狩猎</span>
            </a>
            <a href="threat-intelligence.html" class="menu-item">
                <i class="fas fa-shield-alt"></i>
                <span>威胁情报</span>
            </a>
            <a href="report-center.html" class="menu-item">
                <i class="fas fa-file-alt"></i>
                <span>报告中心</span>
            </a>
            <a href="system-management.html" class="menu-item">
                <i class="fas fa-cog"></i>
                <span>系统管理</span>
            </a>
        </div>
    </div>

    <!-- 右侧主内容区 -->
    <div class="main-container">
        <div class="top-bar">
            <div class="breadcrumbs">当前位置: 资产管理 / <span id="breadcrumb">资产清单</span></div>
            <div class="user-info"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='30' r='20' fill='%233498db'/%3E%3Cpath d='M10,90 C10,65 30,55 50,55 C70,55 90,65 90,90' fill='%233498db'/%3E%3C/svg%3E" alt="用户头像"><span>安全分析师</span></div>
        </div>

        <div class="content-area">
            <h2 class="page-title">资产管理中心</h2>
            
            <!-- Tab Navigation -->
            <div class="tab-nav">
                <div class="tab-item active" id="tab-inventory" onclick="showTab('inventory')"><i class="fas fa-list-ul"></i> 资产清单</div>
                <div class="tab-item" id="tab-vulnerability" onclick="showTab('vulnerability')"><i class="fas fa-bug"></i> 漏洞与补丁</div>
                <div class="tab-item" id="tab-compliance" onclick="showTab('compliance')"><i class="fas fa-check-double"></i> 基线合规</div>
            </div>

            <!-- Tab Content: Asset Inventory -->
            <div class="tab-content active" id="content-inventory">
                <div class="stat-cards">
                    <div class="stat-card"><div class="stat-card-value">2,456</div><div class="stat-card-label">资产总数</div></div>
                    <div class="stat-card"><div class="stat-card-value success">2,407</div><div class="stat-card-label">在线资产</div></div>
                    <div class="stat-card"><div class="stat-card-value high">73</div><div class="stat-card-label">受威胁资产</div></div>
                    <div class="stat-card"><div class="stat-card-value medium">42</div><div class="stat-card-label">未安装EDR</div></div>
                </div>
                
                <!-- 图表行：资产分布和终端安全状态分布 -->
                <div class="charts-row">
                    <!-- 资产分布图表 -->
                    <div class="card chart-card">
                        <h3 style="margin-bottom: 15px;">资产分布</h3>
                        <div class="chart-container">
                            <canvas id="assetDistributionChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- 终端安全状态分布图表 -->
                    <div class="card chart-card">
                        <h3 style="margin-bottom: 15px;">终端安全状态分布</h3>
                        <div class="chart-container">
                            <canvas id="endpointStatusChart"></canvas>
                        </div>
                    </div>
                </div>
            
                 <div class="card">
                    <h3>资产列表</h3>
                    <table class="data-table">
                         <thead><tr><th>主机名</th><th>IP地址</th><th>类型</th><th>状态</th><th>EDR版本</th><th>所属部门</th><th>负责人</th><th>最后在线时间</th><th>操作</th></tr></thead>
                         <tbody>
                            <tr><td>WIN-SERVER-01</td><td>192.168.1.101</td><td><span class="tag tag-server">服务器</span></td><td><span class="tag tag-danger">受威胁</span></td><td>5.2.3</td><td>IT部</td><td>张三</td><td>2025-08-27 14:30</td><td class="table-actions"><button class="btn btn-outline btn-sm">详情</button></td></tr>
                            <tr><td>DESKTOP-8F3K29A</td><td>192.168.2.56</td><td><span class="tag tag-workstation">工作站</span></td><td><span class="tag tag-warning">需关注</span></td><td>5.1.8</td><td>财务部</td><td>李四</td><td>2025-08-27 13:45</td><td class="table-actions"><button class="btn btn-outline btn-sm">详情</button></td></tr>
                         </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab Content: Vulnerability & Patches -->
            <div class="tab-content" id="content-vulnerability">
                <div class="stat-cards">
                    <div class="stat-card"><div class="stat-card-value critical" id="vul-critical-count">0</div><div class="stat-card-label">严重漏洞</div></div>
                    <div class="stat-card"><div class="stat-card-value high" id="vul-high-count">0</div><div class="stat-card-label">高危漏洞</div></div>
                    <div class="stat-card"><div class="stat-card-value medium" id="vul-medium-count">0</div><div class="stat-card-label">中危漏洞</div></div>
                    <div class="stat-card"><div class="stat-card-value" id="vul-affected-hosts">0</div><div class="stat-card-label">受影响主机</div></div>
                    <div class="stat-card"><div class="stat-card-value" id="vul-missing-patches">0</div><div class="stat-card-label">关键补丁缺失</div></div>
                </div>
                <div class="charts-row">
                    <div class="card" style="flex:1;"><canvas id="vulnSeverityChart"></canvas></div>
                    <div class="card" style="flex:2;"><canvas id="vulnTrendChart"></canvas></div>
                </div>
                <div class="card">
                    <h3>漏洞列表</h3>
                    <table class="data-table" style="margin-top:15px;">
                        <thead><tr><th>CVE ID</th><th>描述</th><th>CVSS</th><th>严重性</th><th>受影响资产</th><th>首次发现</th><th>状态</th><th>操作</th></tr></thead>
                        <tbody id="vulnerability-table-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- Tab Content: Baseline Compliance -->
            <div class="tab-content" id="content-compliance">
                <div class="stat-cards">
                    <div class="stat-card"><div class="stat-card-value success" id="comp-score">0%</div><div class="stat-card-label">总体合规率</div></div>
                    <div class="stat-card"><div class="stat-card-value" id="comp-compliant-hosts">0</div><div class="stat-card-label">合规主机</div></div>
                    <div class="stat-card"><div class="stat-card-value high" id="comp-noncompliant-hosts">0</div><div class="stat-card-label">不合规主机</div></div>
                    <div class="stat-card"><div class="stat-card-value" id="comp-policies">0</div><div class="stat-card-label">策略数</div></div>
                    <div class="stat-card"><div class="stat-card-value critical" id="comp-failed-checks">0</div><div class="stat-card-label">高危不合规项</div></div>
                </div>
                <div class="charts-row">
                    <div class="card" style="flex:2;"><canvas id="complianceByPolicyChart"></canvas></div>
                    <div class="card" style="flex:1;"><canvas id="complianceStatusChart"></canvas></div>
                </div>
                <div class="card">
                    <h3>不合规项列表</h3>
                    <table class="data-table" style="margin-top:15px;">
                        <thead><tr><th>检查项ID</th><th>描述</th><th>严重性</th><th>所属策略</th><th>不合规资产数</th><th>操作</th></tr></thead>
                        <tbody id="compliance-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // --- Mock Data Generators ---
        const generateRandom = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const VULN_DESCRIPTIONS = [
            { cve: "CVE-2025-20251", desc: "远程代码执行漏洞", software: "Apache Struts" },
            { cve: "CVE-2025-31415", desc: "SQL注入漏洞", software: "MySQL Server" },
            { cve: "CVE-2025-16180", desc: "权限提升漏洞", software: "Windows Kernel" },
            { cve: "CVE-2025-41111", desc: "跨站脚本(XSS)漏洞", software: "Nginx" },
            { cve: "CVE-2025-00700", desc: "Log4j 远程代码执行", software: "Log4j" },
        ];
        const COMPLIANCE_CHECKS = [
            { id: "CIS-WIN-1.1.1", desc: "确保'强制密码历史'设置为'24'或更多", policy: "CIS Windows Server 2019" },
            { id: "CIS-LNX-5.2.14", desc: "确保SSH Root登录被禁用", policy: "CIS Ubuntu Linux 20.04" },
            { id: "PCI-DSS-8.2.3", desc: "密码必须至少为7个字符", policy: "PCI DSS v3.2.1" },
            { id: "ISO-27001-A.12.1", desc: "确保安装了反恶意软件", policy: "ISO 27001" },
        ];

        let vulnerabilities = [];
        let complianceItems = [];

        function generateMockData() {
            vulnerabilities = Array.from({ length: 50 }, (_, i) => {
                const template = VULN_DESCRIPTIONS[i % VULN_DESCRIPTIONS.length];
                const cvss = (Math.random() * 10).toFixed(1);
                let severity;
                if (cvss >= 9.0) severity = 'critical';
                else if (cvss >= 7.0) severity = 'high';
                else if (cvss >= 4.0) severity = 'medium';
                else severity = 'low';
                return { ...template, cvss, severity, affected: generateRandom(1, 50), firstSeen: `2025-08-${generateRandom(1,27)}`, status: ['新发现', '处理中', '已修复'][generateRandom(0,2)] };
            });

            complianceItems = Array.from({ length: 30 }, (_, i) => {
                const template = COMPLIANCE_CHECKS[i % COMPLIANCE_CHECKS.length];
                const severity = ['高', '中', '低'][generateRandom(0,2)];
                return { ...template, severity, affected: generateRandom(5, 100) };
            });
        }

        // --- Chart Instances ---
        let charts = {};

        // --- Tab Switching Logic ---
        function showTab(tabName) {
            // Update Tab content
            document.querySelectorAll('.tab-item, .tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
            document.getElementById(`content-${tabName}`).classList.add('active');
            
            // Update Breadcrumb
            const tabTitle = document.getElementById(`tab-${tabName}`).innerText.trim();
            document.getElementById('breadcrumb').innerText = tabTitle;

            // Lazy load charts: Initialize only on first view
            if (tabName === 'vulnerability' && !charts.vulnSeverityChart) initVulnerabilityCharts();
            if (tabName === 'compliance' && !charts.complianceStatusChart) initComplianceCharts();
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
            generateMockData();
            initStatusCharts();
            populateVulnerabilityTab();
            populateComplianceTab();
        });

        // --- Vulnerability Tab Functions ---
        function populateVulnerabilityTab() {
            const counts = vulnerabilities.reduce((acc, v) => {
                acc[v.severity] = (acc[v.severity] || 0) + 1;
                return acc;
            }, { critical: 0, high: 0, medium: 0, low: 0 });
            document.getElementById('vul-critical-count').textContent = counts.critical;
            document.getElementById('vul-high-count').textContent = counts.high;
            document.getElementById('vul-medium-count').textContent = counts.medium;
            document.getElementById('vul-affected-hosts').textContent = [...new Set(vulnerabilities.map(v => v.affected))].length;
            document.getElementById('vul-missing-patches').textContent = generateRandom(20, 100);

            const tableBody = document.getElementById('vulnerability-table-body');
            tableBody.innerHTML = vulnerabilities.slice(0, 10).map(v => `
                <tr>
                    <td><a href="#">${v.cve}</a></td>
                    <td>${v.desc}</td>
                    <td class="cvss-score">${v.cvss}</td>
                    <td><span class="tag severity-${v.severity}">${v.severity}</span></td>
                    <td>${v.affected}台</td>
                    <td>${v.firstSeen}</td>
                    <td>${v.status}</td>
                    <td class="table-actions"><button class="btn btn-outline btn-sm">详情</button></td>
                </tr>
            `).join('');
        }

        function initVulnerabilityCharts() {
            const severityCounts = vulnerabilities.reduce((acc, v) => {
                acc[v.severity] = (acc[v.severity] || 0) + 1;
                return acc;
            }, { critical: 0, high: 0, medium: 0, low: 0 });
            charts.vulnSeverityChart = new Chart(document.getElementById('vulnSeverityChart'), {
                type: 'doughnut',
                data: {
                    labels: ['严重', '高危', '中危', '低危'],
                    datasets: [{
                        data: [severityCounts.critical, severityCounts.high, severityCounts.medium, severityCounts.low],
                        backgroundColor: ['#c0392b', '#e74c3c', '#f39c12', '#3498db']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: '漏洞严重性分布' }}}
            });

            charts.vulnTrendChart = new Chart(document.getElementById('vulnTrendChart'), {
                type: 'line',
                data: {
                    labels: ['-6天', '-5天', '-4天', '-3天', '-2天', '昨天', '今天'],
                    datasets: [
                        { label: '新增漏洞', data: Array.from({length: 7}, () => generateRandom(5, 20)), borderColor: '#e74c3c', tension: 0.3, fill: true, backgroundColor: 'rgba(231, 76, 60, 0.1)' },
                        { label: '已修复漏洞', data: Array.from({length: 7}, () => generateRandom(5, 15)), borderColor: '#27ae60', tension: 0.3, fill: true, backgroundColor: 'rgba(39, 174, 96, 0.1)' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: '漏洞趋势 (近7天)' }}}
            });
        }

        // --- Compliance Tab Functions ---
        function populateComplianceTab() {
            const totalHosts = 2456;
            const nonCompliantHosts = [...new Set(complianceItems.flatMap(c => Array.from({length: c.affected}, (_, i) => `host-${i}`)))].length;
            document.getElementById('comp-score').textContent = `${((totalHosts - nonCompliantHosts) / totalHosts * 100).toFixed(1)}%`;
            document.getElementById('comp-compliant-hosts').textContent = totalHosts - nonCompliantHosts;
            document.getElementById('comp-noncompliant-hosts').textContent = nonCompliantHosts;
            document.getElementById('comp-policies').textContent = [...new Set(complianceItems.map(c => c.policy))].length;
            document.getElementById('comp-failed-checks').textContent = complianceItems.filter(c => c.severity === '高').length;

            const tableBody = document.getElementById('compliance-table-body');
            tableBody.innerHTML = complianceItems.slice(0, 10).map(c => `
                <tr>
                    <td>${c.id}</td>
                    <td>${c.desc}</td>
                    <td><span class="tag ${c.severity === '高' ? 'severity-high' : 'severity-medium'}">${c.severity}</span></td>
                    <td>${c.policy}</td>
                    <td>${c.affected}台</td>
                    <td class="table-actions"><button class="btn btn-outline btn-sm">详情</button></td>
                </tr>
            `).join('');
        }

        function initComplianceCharts() {
            const policyCompliance = complianceItems.reduce((acc, c) => {
                if (!acc[c.policy]) acc[c.policy] = { total: 100, failed: 0 };
                acc[c.policy].failed += 5; // Assume each failure reduces score
                return acc;
            }, {});
            charts.complianceByPolicyChart = new Chart(document.getElementById('complianceByPolicyChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(policyCompliance),
                    datasets: [{
                        label: '合规率 (%)',
                        data: Object.values(policyCompliance).map(p => Math.max(0, 100 - p.failed)),
                        backgroundColor: '#3498db'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false }, title: { display: true, text: '各策略合规率' }}}
            });
            
            const compliantHosts = parseInt(document.getElementById('comp-compliant-hosts').textContent);
            const nonCompliantHosts = parseInt(document.getElementById('comp-noncompliant-hosts').textContent);
            charts.complianceStatusChart = new Chart(document.getElementById('complianceStatusChart'), {
                type: 'pie',
                data: {
                    labels: ['合规主机', '不合规主机'],
                    datasets: [{
                        data: [compliantHosts, nonCompliantHosts],
                        backgroundColor: ['#27ae60', '#e74c3c']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: '主机合规状态' }}}
            });
        }
        
        function initStatusCharts() {
            // 初始化资产分布图表
            const assetDistributionCtx = document.getElementById('assetDistributionChart').getContext('2d');
            const assetDistributionChart = new Chart(assetDistributionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['服务器', '工作站', '移动设备', '蜜罐'],
                    datasets: [{
                        data: [342, 1876, 238, 16],
                        backgroundColor: [
                            '#3b82f6',
                            '#6366f1',
                            '#10b981',
                            '#f13921'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // 初始化终端安全状态分布图表
            const endpointStatusCtx = document.getElementById('endpointStatusChart').getContext('2d');
            window.endpointStatusChart = new Chart(endpointStatusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['安全', '警告', '危险', '离线', '待处理'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.7)',
                            'rgba(255, 193, 7, 0.7)',
                            'rgba(220, 53, 69, 0.7)',
                            'rgba(108, 117, 125, 0.7)',
                            'rgba(23, 162, 184, 0.7)'
                        ],
                        borderColor: [
                            'rgba(40, 167, 69, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(220, 53, 69, 1)',
                            'rgba(108, 117, 125, 1)',
                            'rgba(23, 162, 184, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                    return `${context.label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

    </script>
</body>
</html>
